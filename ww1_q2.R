rm(list = ls())
x=c(171, 170.4, 174.9, 166.2, 165.2, 180, 174.6, 183.2, 176.5, 178.8, 169.9, 177.3, 179, 160.6, 179, 169.6, 186.8, 184.1, 173.9, 179.3, 169, 163.5, 176.2, 167.9, 169.4, 176.8, 176.6, 164.4, 165.8, 183.9, 172.7, 169.8, 174.7, 173.8, 178.5, 164.1, 163.5, 176.9, 169, 189.3, 173.5, 170.8, 169.2, 159.5, 172.3, 167.1, 173.4, 169, 169.5, 181, 163.8, 173.9, 179, 186.2, 179.5, 181.2, 182.7, 172.8, 173.6, 160.9, 174.3, 182.2, 167.8, 174.7, 171.6, 164.2, 178.5, 162.3, 162.6, 169.9, 179.6, 170.1, 177.4, 166.6, 183.2, 161.6, 182.8, 170.8, 166.5, 183.6, 168.4, 165.6, 171, 174.3, 157.8, 183.1, 168.2, 183.6, 172.1, 193.4, 169.4, 187.8, 175.1, 168.4, 194.3, 184.5, 167.5, 158.7, 169.1, 165.4, 168.8, 178.3, 171.4, 183.2, 162.3, 175.9, 177.1, 182, 172.5, 181.9, 165.8, 173, 170.6, 167.9, 161.5, 179.7, 169.7, 169.6, 185.1, 191.3, 175.9, 163.9, 164.1, 187.7, 185.6, 174.8, 171.9, 173.2, 174, 172.3, 175.9, 175.1, 182.1, 175.1, 183.2, 177.6, 172.1, 178.1, 173.3, 171.1, 160.6, 176.6, 177, 170, 174.2, 165.7, 168.2, 179.9, 180.1, 166.2, 166.2, 180.2, 166.5, 171.9, 174, 164.3, 175.4, 172.3, 176, 175.4, 174.8, 172.1, 160, 167.6, 167, 168.6, 175.5, 171.9, 180, 163.3, 170.3, 170.7, 170.8, 163.1, 171.2, 169.5, 165.1, 167.8, 158.4, 177)
y=c(173.3, 174.7, 178.8, 163.6, 162, 178.8, 170.1, 177.7, 169.9, 178.1, 170.7, 176.2, 183.6, 164.3, 180, 174.3, 183.3, 183.2, 166.2, 184.1, 169.6, 163.1, 181.4, 167.9, 165.4, 177.1, 174.9, 172.5, 171, 178.3, 156.8, 178.8, 179.3, 170.6, 178.5, 172.7, 163.6, 175.2, 171.4, 192.5, 162.8, 177.8, 177.6, 178.4, 168.2, 180, 178.2, 183.9, 160.4, 170.3, 169.1, 167, 186.6, 187.7, 169.8, 178.8, 176.5, 172.4, 174.6, 164.1, 163.8, 175.3, 182.5, 172.7, 172.9, 175.4, 183.5, 166.3, 174.2, 171.6, 174.4, 184.5, 187.6, 172.9, 188.6, 167.2, 175.4, 173.2, 171.2, 176.2, 167.4, 172.9, 172, 170.1, 165.4, 186.7, 183.8, 188.8, 165.3, 190.3, 174, 187.7, 176.4, 166.9, 192.1, 179.5, 168.7, 157.3, 177.4, 166.5, 179.9, 172.3, 171.6, 177.3, 163.6, 183, 173.8, 175.6, 172.1, 176.1, 169.3, 175.8, 175.9, 167.9, 171.5, 179.7, 171.7, 165.5, 188.9, 198, 180.4, 164.7, 171.8, 184.1, 185, 177.2, 168.1, 176.7, 174.6, 177.2, 179.8, 170.8, 190.5, 178.4, 177.6, 162.4, 176.4, 173.2, 173.6, 180.2, 159, 180.8, 176.1, 182.3, 179.4, 169.3, 163.7, 186.2, 173.1, 174.1, 176.2, 181.8, 166.8, 177, 168.3, 168.6, 166.7, 179.9, 182.8, 179.1, 170.8, 175.7, 176, 169.8, 168.4, 163.3, 165.2, 171.6, 172.2, 172, 174.2, 169.4, 174.7, 167.5, 171.9, 178.7, 157, 172.4, 159.9, 169)
n <- length(x)

# a
xBar <- mean(x)
yBar <- mean(y)
sx <- sqrt( sum((x-xBar)^2)/(n-1) )
sy <- sqrt( sum((y-yBar)^2)/(n-1) )
sxy <- (1/(n-1))*sum((x-xBar)*(y-yBar))
rxy <- sxy/(sx * sy)

# b
linModel <- lm(y ~ x)
b0Hat <- linModel[["coefficients"]][["(Intercept)"]]
b1Hat <- linModel[["coefficients"]][["x"]]

# c
x_chosen <- 177
y_predicted <- b0Hat + b1Hat * x
sigmaHat <- sqrt( sum((y - y_predicted)^2)/(n-2) )
miuYX <- b0Hat + b1Hat * x_chosen
se_miuYX <- sigmaHat * sqrt(1/n + (x_chosen - xBar)^2/((n-1)*(sx)^2))
t_crit <- (qt(c(.025, .975), df=n-2))[2]
predicted_interval <- c(miuYX-t_crit*se_miuYX, miuYX+t_crit*se_miuYX)

# d
n_in_range <- 0
x_in_range <- c()
y_in_range <- c()
i <- 1
while (i <= length(x)){
  if (x[i] >= x_chosen-2.5 && x[i] <= x_chosen+2.5){
    x_in_range <- c(x_in_range, x[i])
    y_in_range <- c(y_in_range, y[i])
    n_in_range <- n_in_range + 1
  }
  i <- i+1
}
y_in_rangeBar <- mean(y_in_range)
sy_in_range <- sqrt( sum((y_in_range-y_in_rangeBar)^2)/(n_in_range-1) )
predicted_interval_custom <- c(y_in_rangeBar-2*sy_in_range/sqrt(n_in_range), y_in_rangeBar+2*sy_in_range/sqrt(n_in_range))