rm(list = ls())
x=c(-0.08955, -0.116457, 0.081953, 0.089772, 0.051721, 0.000196, 0.071522, 0.033009, 0.0351, -0.01996, 0.055779, 0.017615, -0.037675, 0.028115, 0.057133, 0.014651, -0.085532, -0.055388, 0.066516, -0.048612, 0.083928, 0.036193, -0.002293, 0.063257, 0.022393, 0.031457, -0.001048, 0.028097, -0.013593, -0.018426, -0.021708, -0.058467, -0.074467, 0.102307, -0.005071, 0.008497, 0.04266, 0.039787, 0.030852, -0.007526, -0.064699, 0.038793, 0.012519, 0.019571, 0.023947, -0.019988, 0.002843, 0.007043) 
y=c(-0.062669, -0.165514, 0.117081, -0.098828, 0.129259, 0.027767, 0.070758, 0.077571, -0.013032, -0.022631, 0.157752, 0.01936, 0.043661, -0.034447, 0.02299, -0.063771, -0.039316, 0.048148, -0.014649, 0.020381, 0.056224, -0.013762, -0.051921, 0.055139, -0.083019, -0.018317, 0.024927, 0.085363, 0.022041, -0.029711, -0.033271, -0.030647, -0.000342, 0.053617, 0.035673, 0.064812, 0.015134, -0.002603, 0.016942, 0.021688, -0.043275, 0.116327, 0.056151, -0.025544, 0.05593, 0.011572, -0.029547, -0.069338) 
n=length(x)

# a       
linModel <- lm(y ~ x)

# b
t_crits <- qt(c(.025, .975), df=n-2)
t_crit <- t_crits[2]
xbar <- (1/n)*sum(x)
ybar <- (1/n)*sum(y)
sx <- sqrt( sum((x-xbar)^2)/(n-1) )
sy <- sqrt( sum((y-ybar)^2)/(n-1) )
sxy <- (1/(n-1))*sum((x-xbar)*(y-ybar))
rxy <- sxy/(sx * sy)
b0hat <- linModel[["coefficients"]][["(Intercept)"]]
b1hat <- linModel[["coefficients"]][["x"]]
y_predicted <- b0hat + b1hat * x
sigmahat <- sqrt( sum((y-y_predicted)^2)/(n-2) )

predicted_interval_of_x <- function(x_val) {
  se_E <- sigmahat * sqrt( 1+1/n+(x_val-xbar)^2/((n-1)*sx^2) )
  yhat <- b0hat + b1hat * x_val
  return(c(yhat-t_crit*se_E, yhat+t_crit*se_E))
}

predicted_interval_jan_2013=predicted_interval_of_x(0.049198)
predicted_interval_oct_2013=predicted_interval_of_x(0.04363)

# c
xnext=c(0.049198, 0.011, 0.035355, 0.017924, 0.02055, -0.015113, 0.048278, -0.031798, 0.029316, 0.04363)
ynext=c(0.054967, -0.012094, 0.04349, 0.061324, -0.006281, 0.003594, 0.036544, -0.018545, 0.015731, -0.054344)
count <- 0
i <- 1
for (x_individual in xnext) {
  y_lower <- predicted_interval_of_x(x_individual)[1]
  y_upper <- predicted_interval_of_x(x_individual)[2]
  y_individual <- ynext[i]
  if (y_individual >= y_lower && y_individual <= y_upper){
    count <- count + 1
  }
  i <- i+1
}